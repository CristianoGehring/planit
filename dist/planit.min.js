var Planit,bind=function(t,i){return function(){return t.apply(i,arguments)}};Planit=function(){function t(){}return t.containerClass="planit-container",t.draggingClass="is-dragging",t.imageContainer="planit-image-container",t.infoboxClass="planit-infobox",t.infoboxContainerClass="planit-infobox-container",t.markerClass="planit-marker",t.markerContainerClass="planit-markers-container",t.markerContentClass="planit-marker-content",t.prototype["new"]=function(i){return this.options=null!=i?i:{},new t.Plan(this.options)},t.randomString=function(t){var i;return null==t&&(t=16),i=Math.random().toString(36).slice(2),i+=Math.random().toString(36).slice(2),i.substring(0,t-1)},t}(),Planit.Plan=function(){function t(t){var i,o,n,a;for(this.options=null!=t?t:{},this.zoomOut=bind(this.zoomOut,this),this.zoomIn=bind(this.zoomIn,this),this.calc=bind(this.calc,this),this.zoomTo=bind(this.zoomTo,this),this.centerOn=bind(this.centerOn,this),this.resetImage=bind(this.resetImage,this),a=P(),i=0,o=a.length;o>i;i++)n=a[i],n.call(this)}var i,o,n,a,s,e,r,h,c,l,f,d,m,g,u,p,b,P,x,C,k,v,I,w,y,z,M,F,D,H,W;return P=function(){return[x,g,p,m,u]},x=function(){return this.options.container=$(this.options.container?"#"+this.options.container:"#planit"),this.container=this.options.container},g=function(){return this.container.addClass(Planit.containerClass),this.container.append('<div class="'+Planit.infoboxContainerClass+'"></div>\n<div class="'+Planit.markerContainerClass+'"></div>'),this.markersContainer=this.container.find("."+Planit.markerContainerClass).first()},p=function(){return this.options.image&&this.options.image.url?(this.container.prepend('<div class="'+Planit.imageContainer+'">\n  <img src="'+this.options.image.url+'">\n</div>'),this.image=this.container.find("img").first(),this.image.load(function(t){return function(){return t.container.css({height:t.image.height()}),k.call(t),b.call(t)}}(this))):void 0},k=function(){return this.zoomId=Planit.randomString(),this.markersContainer.attr("data-zoom-id",this.zoomId),this.resetImage(),this.options.image.zoom?C.call(this):void 0},C=function(){return this.container.prepend('<div class="planit-controls">\n  <a href="#" class="zoom" data-action="in">+</a>\n  <a href="#" class="zoom" data-action="out">-</a>\n</div>'),this.container.find(".zoom[data-action='in']").click(function(t){return function(i){return i.preventDefault(),t.zoomIn()}}(this)),this.container.find(".zoom[data-action='out']").click(function(t){return function(i){return i.preventDefault(),t.zoomOut()}}(this)),this.container.on("dblclick",function(t){return function(i){return M.call(t,i)}}(this)),this.container.on("mousedown",function(t){return function(i){return D.call(t,i)}}(this)),$(document).on("mousemove",function(t){return function(i){return H.call(t,i)}}(this)),$(document).on("mouseup",function(t){return function(i){return W.call(t,i)}}(this))},m=function(){return this.options.image&&this.options.image.url?void 0:b.call(this)},b=function(){var t,i,o,n,a;if(this.options.markers&&this.options.markers.length>0){for(n=this.options.markers,a=[],t=0,i=n.length;i>t;t++)o=n[t],o.container=this.container,a.push(Planit.Marker.create(o));return a}},u=function(){return this.container.find("."+Planit.imageContainer+" > img").length>0&&(this.image=this.container.find("."+Planit.imageContainer+" > img").first()),$(document).on("mousemove",function(t){return function(i){return v.call(t,i)}}(this)),$(document).on("mouseup",function(t){return function(i){return I.call(t,i)}}(this))},t.prototype.resetImage=function(){return this.imagePosition={leftPx:0,topPx:0,width:this.image.width(),height:this.image.height(),scale:1,increment:.5},y.call(this)},y=function(){return this.image.css({left:this.imagePosition.leftPx+"px",top:this.imagePosition.topPx+"px",width:100*this.imagePosition.scale+"%",height:"auto"}),z.call(this)},i=function(){return this.image.animate({left:this.imagePosition.leftPx+"px",top:this.imagePosition.topPx+"px",width:100*this.imagePosition.scale+"%",height:"auto"},250),o.call(this)},z=function(){var t,i,o,n,a,s;if(a=this.container.find("."+Planit.markerClass),a.length>0){for(t=0,o=a.length;o>t;t++)n=a[t],i=this.calc(f)*($(n).attr("data-xPc")/100)+this.imagePosition.leftPx-$(n).outerWidth()/2,s=this.calc(r)*($(n).attr("data-yPc")/100)+this.imagePosition.topPx-$(n).outerHeight()/2,$(n).css({left:i+"px",top:s+"px"});return w.call(this)}},o=function(){var t,i,o,n,a,s,e,h;if(s=this.container.find("."+Planit.markerClass),s.length>0){for(e=[],t=0,o=s.length;o>t;t++)a=s[t],n=new Planit.Marker(this.container,$(a).attr("data-marker")),n.hideInfobox(),i=this.calc(f)*($(a).attr("data-xPc")/100)+this.imagePosition.leftPx-$(a).outerWidth()/2,h=this.calc(r)*($(a).attr("data-yPc")/100)+this.imagePosition.topPx-$(a).outerHeight()/2,e.push(function(t){return $(a).animate({left:i+"px",top:h+"px"},250,function(){return function(){return t.positionInfobox(),t.unhideInfobox()}}(this))}(n));return e}},w=function(){var t,i,o,n,a;for(a=this.container.find("."+Planit.markerClass),t=0,i=a.length;i>t;t++)n=a[t],o=new Planit.Marker(this.container,$(n).attr("data-marker")),o.positionInfobox();return!0},t.prototype.centerOn=function(t){var o,s,e,h;for(e=t[0]>=50?100-t[0]:t[0],h=t[1]>=50?100-t[1]:t[1],s=50*(this.calc(a)/e),o=50*(this.calc(n)/h),this.container.find("."+Planit.infoboxClass).removeClass("active"),this.imagePosition.leftPx=-(this.calc(f)*(t[0]/100)-this.calc(a)/2),this.imagePosition.topPx=-(this.calc(r)*(t[1]/100)-this.calc(n)/2);this.calc(f)<s||this.calc(r)<o;)this.imagePosition.scale=this.imagePosition.scale+this.imagePosition.increment,this.imagePosition.leftPx=-(this.calc(f)*(t[0]/100)-this.calc(a)/2),this.imagePosition.topPx=-(this.calc(r)*(t[1]/100)-this.calc(n)/2);return i.call(this),t},t.prototype.zoomTo=function(t){var i;return i=this.imagePosition.increment,t*i+1!==this.imagePosition.scale&&(this.imagePosition.scale=t*i+1+i,this.zoomOut()),t},t.prototype.calc=function(t){return t.call(this)},f=function(){return parseFloat(this.imagePosition.width*this.imagePosition.scale)},d=function(){return parseFloat(this.imagePosition.width*this.imagePosition.increment)},a=function(){return parseFloat(this.markersContainer.width())},c=function(){return Math.abs(parseFloat(this.image.css("left")))},r=function(){return parseFloat(this.imagePosition.height*this.imagePosition.scale)},h=function(){return parseFloat(this.imagePosition.height*this.imagePosition.increment)},n=function(){return parseFloat(this.markersContainer.height())},l=function(){return Math.abs(parseFloat(this.image.css("top")))},F=function(t){return{left:(t.pageX-this.container.offset().left)/this.calc(a),top:(t.pageY-this.container.offset().top)/this.calc(n)}},M=function(t){var i;return $(t.target).attr("data-zoom-id")===this.zoomId?(i=F.call(this,t),this.zoomIn("click",i.left,i.top)):void 0},D=function(t){var i;return $(t.target).attr("data-zoom-id")===this.zoomId&&1===t.which&&(this.isDragging=!0,i=F.call(this,t),this.dragCoords={pointRef:i,imgRef:{left:0-this.calc(c),top:0-this.calc(l)},max:{right:i.left*this.calc(a)+this.calc(c),left:i.left*this.calc(a)-(this.calc(f)-(this.calc(a)+this.calc(c))),bottom:i.top*this.calc(n)+this.calc(l),top:i.top*this.calc(n)-(this.calc(r)-(this.calc(n)+this.calc(l)))}}),!0},H=function(t){var i,o,s,e,h;return this.isDragging&&(i=F.call(this,t),o=i.left*this.calc(a),s=i.top*this.calc(n),o>=this.dragCoords.max.left&&o<=this.dragCoords.max.right?(e=(i.left-this.dragCoords.pointRef.left)*this.calc(a),this.imagePosition.leftPx=this.dragCoords.imgRef.left+e):o<this.dragCoords.max.left?this.imagePosition.leftPx=this.calc(a)-this.calc(f):o>this.dragCoords.max.right&&(this.imagePosition.leftPx=0),s>=this.dragCoords.max.top&&s<=this.dragCoords.max.bottom?(h=(i.top-this.dragCoords.pointRef.top)*this.calc(n),this.imagePosition.topPx=this.dragCoords.imgRef.top+h):s<this.dragCoords.max.top?this.imagePosition.topPx=this.calc(n)-this.calc(r):s>this.dragCoords.max.bottom&&(this.imagePosition.topPx=0),y.call(this)),!0},W=function(){return this.isDragging=!1,w.call(this),!0},t.prototype.zoomIn=function(){return this.imagePosition.scale=this.imagePosition.scale+this.imagePosition.increment,this.imagePosition.leftPx=-this.calc(c)-this.calc(d)/2,this.imagePosition.topPx=-this.calc(l)-this.calc(h)/2,i.call(this)},t.prototype.zoomOut=function(){var t,o;return this.imagePosition.scale>1?(this.imagePosition.scale=this.imagePosition.scale-this.imagePosition.increment,t=-this.calc(c)+this.calc(d)/2,o=-this.calc(l)+this.calc(h)/2,this.imagePosition.leftPx=t>0?0:t<this.calc(a)-this.calc(f)?this.calc(a)-this.calc(f):t,this.imagePosition.topPx=o>0?0:o<this.calc(n)-this.calc(r)?this.calc(n)-this.calc(r):o,i.call(this)):void 0},s=function(){return this.markersContainer.find("."+Planit.markerClass+"."+Planit.draggingClass)},e=function(t){var i,o,s,e,r,h,c,l;return this.image?(r=t.pageX-this.container.offset().left,l=t.pageY-this.container.offset().top,o=this.image.width(),i=this.image.height(),s=parseInt(this.image.css("left")),h=parseInt(this.image.css("top")),e=(r+Math.abs(s))/o*100,c=(l+Math.abs(h))/i*100):(e=(t.pageX-this.container.offset().left)/this.calc(a),c=(t.pageY-this.container.offset().top)/this.calc(n)),[e,c]},I=function(t){var i,o;return o=this.markersContainer.find("."+Planit.draggingClass).first(),s.call(this).length>0&&(i=new Planit.Marker(this.container,o.attr("data-marker")),this.options.markerDragEnd(t,i),i.savePosition(),i.positionInfobox(),s.call(this).removeClass(Planit.draggingClass)),$(t.target).hasClass(Planit.markerContainerClass)&&this.options.canvasClick(t,e.call(this,t)),($(t.target).hasClass(Planit.markerClass)||$(t.target).parents("."+Planit.markerClass).length>0)&&(o=$(t.target).hasClass(Planit.markerClass)?$(t.target):$(t.target).parents("."+Planit.markerClass).first(),i=new Planit.Marker(this.container,o.attr("data-marker")),this.options.markerClick(t,i)),!0},v=function(t){var i,o,n,a,s,e,r,h,c,l,f,d,m,g;return l=this.markersContainer.find("."+Planit.markerClass+"."+Planit.draggingClass),l.length>0?(i=l.first(),(Math.abs(t.pageX-i.attr("data-drag-start-x"))>0||Math.abs(t.pageY-i.attr("data-drag-start-y"))>0)&&this.container.find("#"+i.attr("data-infobox")).removeClass("active"),f=t.pageX-this.container.offset().left,d=t.pageY-this.container.offset().top,g=this.container.width(),m=this.container.height(),a=f-i.outerWidth()/2,e=d-i.outerHeight()/2,s=f+i.outerWidth()/2,o=d+i.outerHeight()/2,r=i.outerWidth(),n=i.outerHeight(),h=0>=a?0:g>s?a:g-r,c=0>=e?0:m>o?e:m-n,i.css({left:h,top:c})):void 0},t}(),Planit.Marker=function(){function t(t,i){this.container=t,this.remove=bind(this.remove,this),this.update=bind(this.update,this),this.savePosition=bind(this.savePosition,this),this.set=bind(this.set,this),this.animateInfobox=bind(this.animateInfobox,this),this.positionInfobox=bind(this.positionInfobox,this),this.infoboxCoords=bind(this.infoboxCoords,this),this.unhideInfobox=bind(this.unhideInfobox,this),this.showInfobox=bind(this.showInfobox,this),this.hideInfobox=bind(this.hideInfobox,this),this.infoboxVisible=bind(this.infoboxVisible,this),this.infoboxHTML=bind(this.infoboxHTML,this),this.infobox=bind(this.infobox,this),this.isDraggable=bind(this.isDraggable,this),this.id=bind(this.id,this),this.planitID=bind(this.planitID,this),this.color=bind(this.color,this),this.relativePosition=bind(this.relativePosition,this),this.position=bind(this.position,this),this.markersContainer=this.container.find("."+Planit.markerContainerClass),this.container.find("."+Planit.imageContainer+" > img").length>0&&(this.image=this.container.find("."+Planit.imageContainer+" > img").first()),this.marker=this.markersContainer.find("."+Planit.markerClass+"[data-marker='"+i+"']").first()}return t.create=function(t){var i,o,n,a,s,e,r,h,c,l,f,d,m;return s=t.container,f=s.find("."+Planit.markerContainerClass).first(),t.planitID||(t.planitID=Planit.randomString(20)),a=t.color?t.color:"#FC5B3F",h=parseFloat(t.coords[0])/100*s.width()-15,m=parseFloat(t.coords[1])/100*s.height()-15,f.append($("<div></div>").addClass(Planit.markerClass).attr({"data-marker":t.planitID,"data-xPc":t.coords[0],"data-yPc":t.coords[1]}).css({left:h+"px",top:m+"px",backgroundColor:a})),l=f.find("."+Planit.markerClass).last(),t.id&&l.attr({"data-id":t.id}),t["class"]&&l.addClass(t["class"]),t.html&&l.html(t.html),t.size&&l.css({width:t.size+"px",height:t.size+"px"}),t.draggable&&(l.addClass("draggable"),l.on("mousedown",function(){return function(t){return 1===t.which?(l=$(t.target).closest("."+Planit.markerClass),l.addClass(Planit.draggingClass),l.attr({"data-drag-start-x":t.pageX,"data-drag-start-y":t.pageY})):void 0}}(this))),t.infobox?(e=Planit.randomString(16),r=t.infobox,d=r.position?r.position:"top",i=r.arrow?!0:!1,o=i===!0?"arrow":"",n=Planit.infoboxClass+" "+d+" "+o,s.find("."+Planit.infoboxContainerClass).append('<div class="'+n+'" id="info-'+e+'"\n  data-position="'+d+'">\n    '+r.html+"\n</div>"),r.offsetX&&s.find("."+Planit.infoboxClass).last().attr({"data-offset-x":r.offsetX}),r.offsetY&&s.find("."+Planit.infoboxClass).last().attr({"data-offset-y":r.offsetY}),l.attr("data-infobox","info-"+e),c=new Planit.Marker(s,t.planitID),c.positionInfobox(),c):void 0},t.prototype.position=function(){var t,i,o,n,a,s,e,r;return a=this.marker.position().left+this.marker.outerWidth()/2,r=this.marker.position().top+this.marker.outerHeight()/2,this.image?(i=this.image.width(),t=this.image.height(),o=parseInt(this.image.css("left")),s=parseInt(this.image.css("top")),n=(a+Math.abs(o))/i*100,e=(r+Math.abs(s))/t*100):(n=a/this.container.width()*100,e=r/this.container.height()*100),[n,e]},t.prototype.relativePosition=function(){var t,i,o,n;return i=this.marker.position().left+this.marker.outerWidth()/2,n=this.marker.position().top+this.marker.outerHeight()/2,t=i/this.container.width()*100,o=n/this.container.height()*100,[t,o]},t.prototype.color=function(){return this.marker.css("backgroundColor")},t.prototype.planitID=function(){return this.marker.attr("data-marker")},t.prototype.id=function(){return this.marker.attr("data-id")},t.prototype.isDraggable=function(){return this.marker.hasClass("draggable")},t.prototype.infobox=function(){var t;return t=this.container.find("#"+this.marker.attr("data-infobox")),t.length>0?t:null},t.prototype.infoboxHTML=function(){return this.infobox()&&this.infobox().length>0?this.infobox().html():null},t.prototype.infoboxVisible=function(){return this.infobox()&&this.infobox().hasClass("active")},t.prototype.hideInfobox=function(){return this.infoboxVisible()?this.infobox().addClass("hidden"):void 0},t.prototype.showInfobox=function(){return this.infobox()&&!this.infoboxVisible()&&this.infobox().addClass("active"),this.unhideInfobox()},t.prototype.unhideInfobox=function(){return this.infoboxVisible()?this.infobox().removeClass("hidden"):void 0},t.prototype.infoboxCoords=function(){var t,i,o,n,a,s,e,r,h,c,l,f,d,m,g,u,p,b;switch(c=this.container.find("#"+this.marker.attr("data-infobox")),g=parseFloat(this.relativePosition()[0]/100)*this.container.width(),u=parseFloat(this.relativePosition()[1]/100)*this.container.height(),e=c.outerWidth(),a=e/2,s=c.outerHeight(),n=s/2,o=this.container.width(),i=this.container.height(),m=this.marker.outerWidth(),f=m/2,d=this.marker.outerHeight(),l=d/2,t=5,p=parseInt(c.attr("data-offset-x")),p||(p=0),b=parseInt(c.attr("data-offset-y")),b||(b=0),c.attr("data-position")){case"top":r=g-a,h=u-s-l-t;break;case"right":r=g+f+t,h=u-n;break;case"bottom":r=g-a,h=u+l+t;break;case"left":r=g-e-f-t,h=u-n;break;case"top-left":r=g-e-f+t,h=u-s-l+t;break;case"top-right":r=g+f-t,h=u-s-l+t;break;case"bottom-left":r=g-e-f+t,h=u+l-t;break;case"bottom-right":r=g+f-t,h=u+l-t}return{left:r+p,top:h+b}},t.prototype.positionInfobox=function(){var t;return t=this.infoboxCoords(),this.container.find("#"+this.marker.attr("data-infobox")).css({left:t.left+"px",top:t.top+"px"}),this.position()},t.prototype.animateInfobox=function(){var t;return t=this.infoboxCoords(),this.container.find("#"+this.marker.attr("data-infobox")).animate({left:t.left+"px",top:t.top+"px"},250,function(t){return function(){return t.position()}}(this))},t.prototype.set=function(){var t,i;return t=this.image.width()*(this.marker.attr("data-xPc")/100)+parseFloat(this.image.css("left"))-this.marker.outerWidth()/2,i=this.image.height()*(this.marker.attr("data-yPc")/100)+parseFloat(this.image.css("top"))-this.marker.outerHeight()/2,this.marker.css({left:t+"px",top:i+"px"}),this.positionInfobox(),[t,i]},t.prototype.savePosition=function(){var t;return t=this.position(),this.marker.attr({"data-xPc":t[0],"data-yPc":t[1]})},t.prototype.update=function(t){var i,o;return t.color&&this.marker.css({backgroundColor:t.color}),t.infobox&&(this.marker.find("."+Planit.infoboxClass).html(t.infobox),this.positionInfobox()),t.draggable&&(this.marker.removeClass("draggable"),t.draggable===!0&&this.marker.addClass("draggable")),t.coords?(i=parseFloat(t.coords[0])/100*this.container.width()-15,o=parseFloat(t.coords[1])/100*this.container.height()-15,this.marker.css({left:i+"px",top:o+"px"})):void 0},t.prototype.remove=function(){return this.infobox()&&this.infobox().remove(),this.marker.remove()},t}(),window.planit=new Planit;