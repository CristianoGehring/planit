var Planit,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Planit = (function() {
  function Planit() {
    this.initMarkers = __bind(this.initMarkers, this);
  }

  Planit.prototype["new"] = function(_at_options) {
    this.options = _at_options;
    if (!this.options) {
      this.options = {};
    }
    this.setOptions();
    this.initPlan();
    return $(window).load(this.initMarkers);
  };

  Planit.prototype.setOptions = function() {
    this.setDefaultOptions();
    if (this.options.container) {
      this.planOptions.container = $("#" + this.options.container);
    }
    if (this.options.backgroundImage) {
      return this.planOptions.backgroundImage = this.options.backgroundImage;
    }
  };

  Planit.prototype.setDefaultOptions = function() {
    return this.planOptions = {
      container: $('#planit')
    };
  };

  Planit.prototype.initPlan = function() {
    return this.plan = new Planit.Plan(this.planOptions);
  };

  Planit.prototype.initMarkers = function() {
    var marker, _i, _len, _ref, _results;
    this.markers = new Planit.Marker({
      plan: this.planOptions.container
    });
    _ref = this.options.markers;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      marker = _ref[_i];
      _results.push(this.markers.add(marker));
    }
    return _results;
  };

  return Planit;

})();

window.planit = new Planit;

Planit.Plan = (function() {
  function Plan(_at_options) {
    this.options = _at_options;
    this.initContainers();
    if (this.options.backgroundImage) {
      this.addBackgroundImage();
    }
  }

  Plan.prototype.initContainers = function() {
    this.options.container.addClass('planit-container');
    return this.options.container.append("<div class=\"planit-markers-container\"></div>");
  };

  Plan.prototype.addBackgroundImage = function() {
    this.options.container.append("<img src=\"" + this.options.backgroundImage + "\">");
    this.options.container.find('.planit-markers-container').css({
      backgroundImage: "url('" + this.options.backgroundImage + "')"
    });
    return $(window).load((function(_this) {
      return function() {
        _this.options.container.css({
          height: _this.options.container.find('img').first().height()
        });
        return _this.options.container.find('img').first().remove();
      };
    })(this));
  };

  return Plan;

})();

Planit.Marker = (function() {
  function Marker(_at_options) {
    this.options = _at_options;
    this.mousemove = __bind(this.mousemove, this);
    this.mouseup = __bind(this.mouseup, this);
    this.mousedown = __bind(this.mousedown, this);
    this.setOptions();
    this.bindDraggable();
  }

  Marker.prototype.setOptions = function() {
    this.plan = this.options.plan;
    return this.markersContainer = this.plan.find('.planit-markers-container');
  };

  Marker.prototype.add = function(options) {
    var id, infobox;
    this.markersContainer.append($('<div><div class="planit-marker-content"></div></div>').addClass('planit-marker').css({
      left: options.coords[0] + "%",
      top: options.coords[1] + "%"
    }));
    if (options.draggable) {
      this.lastMarker().addClass('draggable');
      this.lastMarker().on('mousedown', this.mousedown);
    }
    if (options.infobox) {
      id = this.randomString(16);
      this.lastMarker().find('.planit-marker-content').append("<div class=\"planit-infobox\" id=\"info-" + id + "\">" + options.infobox + "</div>");
      this.lastMarker().attr('data-infobox', "info-" + id);
      infobox = $("#" + (this.lastMarker().attr('data-infobox')));
      infobox.css({
        left: -(infobox.width() / 2),
        bottom: infobox.outerHeight() + 5
      });
      this.lastMarker().on('mouseleave', (function(_this) {
        return function(e) {
          var marker;
          marker = $(e.target).closest('.planit-marker');
          infobox = $("#" + (marker.attr('data-infobox')));
          return infobox.removeClass('active');
        };
      })(this));
      return this.lastMarker().on('mouseover', (function(_this) {
        return function(e) {
          var marker;
          marker = $(e.target).closest('.planit-marker');
          infobox = $("#" + (marker.attr('data-infobox')));
          if (marker.hasClass('is-dragging') || _this.draggingMarker().length > 0) {
            return infobox.removeClass('active');
          } else {
            return infobox.addClass('active');
          }
        };
      })(this));
    }
  };

  Marker.prototype.mousedown = function(e) {
    var infoboxID, marker;
    marker = $(e.target).closest('.planit-marker');
    marker.addClass('is-dragging');
    infoboxID = $(e.target).closest('.planit-marker').attr('data-infobox');
    return $("#" + infoboxID).removeClass('active');
  };

  Marker.prototype.mouseup = function(e) {
    var marker;
    if ($(e.target).hasClass('planit-marker-content')) {
      marker = $(e.target).closest('.planit-marker');
      $("#" + (marker.attr('data-infobox'))).addClass('active');
    }
    return this.draggingMarker().removeClass('is-dragging');
  };

  Marker.prototype.mousemove = function(e) {
    var marker, markerBottom, markerHeight, markerLeft, markerRight, markerTop, markerWidth, markerX, markerY, markers, mouseLeft, mouseTop, planBottom, planRight;
    markers = this.markersContainer.find('.planit-marker.is-dragging');
    if (markers.length > 0) {
      marker = markers.first();
      mouseLeft = e.pageX - this.plan.offset().left;
      mouseTop = e.pageY - this.plan.offset().top;
      planRight = this.plan.width();
      planBottom = this.plan.height();
      markerLeft = mouseLeft - (marker.outerWidth() / 2);
      markerTop = mouseTop - (marker.outerHeight() / 2);
      markerRight = mouseLeft + (marker.outerWidth() / 2);
      markerBottom = mouseTop + (marker.outerHeight() / 2);
      markerWidth = marker.outerWidth();
      markerHeight = marker.outerHeight();
      if (markerLeft <= 0) {
        markerX = 0;
      } else if (markerRight < planRight) {
        markerX = markerLeft;
      } else {
        markerX = planRight - markerWidth;
      }
      if (markerTop <= 0) {
        markerY = 0;
      } else if (markerBottom < planBottom) {
        markerY = markerTop;
      } else {
        markerY = planBottom - markerHeight;
      }
      return marker.css({
        left: markerX,
        top: markerY
      });
    }
  };

  Marker.prototype.bindDraggable = function() {
    $(document).on('mousemove', this.mousemove);
    return $(document).on('mouseup', this.mouseup);
  };

  Marker.prototype.markers = function() {
    return this.markersContainer.find('.planit-marker');
  };

  Marker.prototype.draggingMarker = function() {
    return this.markersContainer.find('.planit-marker.is-dragging');
  };

  Marker.prototype.lastMarker = function() {
    return this.markers().last();
  };

  Marker.prototype.randomString = function(length) {
    var str;
    if (length == null) {
      length = 16;
    }
    str = Math.random().toString(36).slice(2);
    str = str + Math.random().toString(36).slice(2);
    return str.substring(0, length - 1);
  };

  return Marker;

})();

//# sourceMappingURL=data:application/json;base64,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QixJQUFDLENBQUEsU0FBN0IsQ0FBQSxDQUFBO1dBQ0EsQ0FBQSxDQUFFLFFBQUYsQ0FBVyxDQUFDLEVBQVosQ0FBZ0IsU0FBaEIsRUFBMEIsSUFBQyxDQUFBLE9BQTNCLEVBRmE7RUFBQSxDQXJHZixDQUFBOztBQUFBLG1CQXlHQSxPQUFBLEdBQVMsU0FBQSxHQUFBO1dBQ1AsSUFBQyxDQUFBLGdCQUFnQixDQUFDLElBQWxCLENBQXdCLGdCQUF4QixFQURPO0VBQUEsQ0F6R1QsQ0FBQTs7QUFBQSxtQkE0R0EsY0FBQSxHQUFnQixTQUFBLEdBQUE7V0FDZCxJQUFDLENBQUEsZ0JBQWdCLENBQUMsSUFBbEIsQ0FBd0IsNEJBQXhCLEVBRGM7RUFBQSxDQTVHaEIsQ0FBQTs7QUFBQSxtQkErR0EsVUFBQSxHQUFZLFNBQUEsR0FBQTtXQUNWLElBQUMsQ0FBQSxPQUFELENBQUEsQ0FBVSxDQUFDLElBQVgsQ0FBQSxFQURVO0VBQUEsQ0EvR1osQ0FBQTs7QUFBQSxtQkFrSEEsWUFBQSxHQUFjLFNBQUMsTUFBRCxHQUFBO0FBQ1osUUFBQSxHQUFBOztNQURhLFNBQVM7S0FDdEI7QUFBQSxJQUFBLEdBQUEsR0FBTSxJQUFJLENBQUMsTUFBTCxDQUFBLENBQWEsQ0FBQyxRQUFkLENBQXVCLEVBQXZCLENBQTBCLENBQUMsS0FBM0IsQ0FBaUMsQ0FBakMsQ0FBTixDQUFBO0FBQUEsSUFDQSxHQUFBLEdBQU0sR0FBQSxHQUFNLElBQUksQ0FBQyxNQUFMLENBQUEsQ0FBYSxDQUFDLFFBQWQsQ0FBdUIsRUFBdkIsQ0FBMEIsQ0FBQyxLQUEzQixDQUFpQyxDQUFqQyxDQURaLENBQUE7V0FFQSxHQUFHLENBQUMsU0FBSixDQUFjLENBQWQsRUFBaUIsTUFBQSxHQUFTLENBQTFCLEVBSFk7RUFBQSxDQWxIZCxDQUFBOztnQkFBQTs7SUFsREYsQ0FBQSIsImZpbGUiOiJwbGFuaXQtdG1wLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgUGxhbml0XG5cbiAgbmV3OiAoQG9wdGlvbnMpIC0+XG4gICAgQG9wdGlvbnMgPSB7fSB1bmxlc3MgQG9wdGlvbnNcbiAgICBAc2V0T3B0aW9ucygpXG4gICAgQGluaXRQbGFuKClcbiAgICAkKHdpbmRvdykubG9hZChAaW5pdE1hcmtlcnMpXG5cbiAgc2V0T3B0aW9uczogLT5cbiAgICBAc2V0RGVmYXVsdE9wdGlvbnMoKVxuICAgIEBwbGFuT3B0aW9ucy5jb250YWluZXIgPSAkKFwiIyN7QG9wdGlvbnMuY29udGFpbmVyfVwiKSBpZiBAb3B0aW9ucy5jb250YWluZXJcbiAgICBAcGxhbk9wdGlvbnMuYmFja2dyb3VuZEltYWdlID0gQG9wdGlvbnMuYmFja2dyb3VuZEltYWdlIGlmIEBvcHRpb25zLmJhY2tncm91bmRJbWFnZVxuXG4gIHNldERlZmF1bHRPcHRpb25zOiAtPlxuICAgIEBwbGFuT3B0aW9ucyA9XG4gICAgICBjb250YWluZXI6ICQoJyNwbGFuaXQnKVxuXG4gIGluaXRQbGFuOiAtPlxuICAgIEBwbGFuID0gbmV3IFBsYW5pdC5QbGFuKEBwbGFuT3B0aW9ucylcblxuICBpbml0TWFya2VyczogPT5cbiAgICBAbWFya2VycyA9IG5ldyBQbGFuaXQuTWFya2VyXG4gICAgICBwbGFuOiBAcGxhbk9wdGlvbnMuY29udGFpbmVyXG4gICAgZm9yIG1hcmtlciBpbiBAb3B0aW9ucy5tYXJrZXJzXG4gICAgICBAbWFya2Vycy5hZGQobWFya2VyKVxuXG53aW5kb3cucGxhbml0ID0gbmV3IFBsYW5pdFxuXG5jbGFzcyBQbGFuaXQuUGxhblxuXG4gIGNvbnN0cnVjdG9yOiAoQG9wdGlvbnMpIC0+XG4gICAgQGluaXRDb250YWluZXJzKClcbiAgICBAYWRkQmFja2dyb3VuZEltYWdlKCkgaWYgQG9wdGlvbnMuYmFja2dyb3VuZEltYWdlXG5cbiAgaW5pdENvbnRhaW5lcnM6IC0+XG4gICAgQG9wdGlvbnMuY29udGFpbmVyLmFkZENsYXNzKCdwbGFuaXQtY29udGFpbmVyJylcbiAgICBAb3B0aW9ucy5jb250YWluZXIuYXBwZW5kKFwiXCJcIjxkaXYgY2xhc3M9XCJwbGFuaXQtbWFya2Vycy1jb250YWluZXJcIj48L2Rpdj5cIlwiXCIpXG5cbiAgYWRkQmFja2dyb3VuZEltYWdlOiAtPlxuICAgIEBvcHRpb25zLmNvbnRhaW5lci5hcHBlbmQoXCJcIlwiPGltZyBzcmM9XCIje0BvcHRpb25zLmJhY2tncm91bmRJbWFnZX1cIj5cIlwiXCIpXG4gICAgQG9wdGlvbnMuY29udGFpbmVyLmZpbmQoJy5wbGFuaXQtbWFya2Vycy1jb250YWluZXInKS5jc3NcbiAgICAgIGJhY2tncm91bmRJbWFnZTogXCJ1cmwoJyN7QG9wdGlvbnMuYmFja2dyb3VuZEltYWdlfScpXCJcbiAgICAkKHdpbmRvdykubG9hZCA9PlxuICAgICAgQG9wdGlvbnMuY29udGFpbmVyLmNzc1xuICAgICAgICBoZWlnaHQ6IEBvcHRpb25zLmNvbnRhaW5lci5maW5kKCdpbWcnKS5maXJzdCgpLmhlaWdodCgpXG4gICAgICBAb3B0aW9ucy5jb250YWluZXIuZmluZCgnaW1nJykuZmlyc3QoKS5yZW1vdmUoKVxuXG5cbmNsYXNzIFBsYW5pdC5NYXJrZXJcblxuICBjb25zdHJ1Y3RvcjogKEBvcHRpb25zKSAtPlxuICAgIEBzZXRPcHRpb25zKClcbiAgICBAYmluZERyYWdnYWJsZSgpXG5cbiAgc2V0T3B0aW9uczogLT5cbiAgICBAcGxhbiA9IEBvcHRpb25zLnBsYW5cbiAgICBAbWFya2Vyc0NvbnRhaW5lciA9IEBwbGFuLmZpbmQoJy5wbGFuaXQtbWFya2Vycy1jb250YWluZXInKVxuXG4gIGFkZDogKG9wdGlvbnMpIC0+XG4gICAgQG1hcmtlcnNDb250YWluZXIuYXBwZW5kKFxuICAgICAgJCgnPGRpdj48ZGl2IGNsYXNzPVwicGxhbml0LW1hcmtlci1jb250ZW50XCI+PC9kaXY+PC9kaXY+JylcbiAgICAgICAgLmFkZENsYXNzKCdwbGFuaXQtbWFya2VyJylcbiAgICAgICAgLmNzc1xuICAgICAgICAgIGxlZnQ6IFwiI3tvcHRpb25zLmNvb3Jkc1swXX0lXCJcbiAgICAgICAgICB0b3A6IFwiI3tvcHRpb25zLmNvb3Jkc1sxXX0lXCJcbiAgICApXG4gICAgaWYgb3B0aW9ucy5kcmFnZ2FibGVcbiAgICAgIEBsYXN0TWFya2VyKCkuYWRkQ2xhc3MoJ2RyYWdnYWJsZScpXG4gICAgICBAbGFzdE1hcmtlcigpLm9uKCdtb3VzZWRvd24nLCBAbW91c2Vkb3duKVxuICAgIGlmIG9wdGlvbnMuaW5mb2JveFxuICAgICAgaWQgPSBAcmFuZG9tU3RyaW5nKDE2KVxuICAgICAgQGxhc3RNYXJrZXIoKS5maW5kKCcucGxhbml0LW1hcmtlci1jb250ZW50JykuYXBwZW5kIFwiXCJcIlxuICAgICAgICA8ZGl2IGNsYXNzPVwicGxhbml0LWluZm9ib3hcIiBpZD1cImluZm8tI3tpZH1cIj4je29wdGlvbnMuaW5mb2JveH08L2Rpdj5cbiAgICAgICAgICBcIlwiXCJcbiAgICAgIEBsYXN0TWFya2VyKCkuYXR0cignZGF0YS1pbmZvYm94JywgXCJpbmZvLSN7aWR9XCIpXG4gICAgICBpbmZvYm94ID0gJChcIiMje0BsYXN0TWFya2VyKCkuYXR0cignZGF0YS1pbmZvYm94Jyl9XCIpXG4gICAgICBpbmZvYm94LmNzc1xuICAgICAgICBsZWZ0OiAtKGluZm9ib3gud2lkdGgoKSAvIDIpXG4gICAgICAgIGJvdHRvbTogaW5mb2JveC5vdXRlckhlaWdodCgpICsgNVxuICAgICAgQGxhc3RNYXJrZXIoKS5vbiAnbW91c2VsZWF2ZScsIChlKSA9PlxuICAgICAgICBtYXJrZXIgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcucGxhbml0LW1hcmtlcicpXG4gICAgICAgIGluZm9ib3ggPSAkKFwiIyN7bWFya2VyLmF0dHIoJ2RhdGEtaW5mb2JveCcpfVwiKVxuICAgICAgICBpbmZvYm94LnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuICAgICAgQGxhc3RNYXJrZXIoKS5vbiAnbW91c2VvdmVyJywgKGUpID0+XG4gICAgICAgIG1hcmtlciA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5wbGFuaXQtbWFya2VyJylcbiAgICAgICAgaW5mb2JveCA9ICQoXCIjI3ttYXJrZXIuYXR0cignZGF0YS1pbmZvYm94Jyl9XCIpXG4gICAgICAgIGlmIG1hcmtlci5oYXNDbGFzcygnaXMtZHJhZ2dpbmcnKSB8fCBAZHJhZ2dpbmdNYXJrZXIoKS5sZW5ndGggPiAwXG4gICAgICAgICAgaW5mb2JveC5yZW1vdmVDbGFzcygnYWN0aXZlJylcbiAgICAgICAgZWxzZVxuICAgICAgICAgIGluZm9ib3guYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cbiAgbW91c2Vkb3duOiAoZSkgPT5cbiAgICBtYXJrZXIgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcucGxhbml0LW1hcmtlcicpXG4gICAgbWFya2VyLmFkZENsYXNzKCdpcy1kcmFnZ2luZycpXG4gICAgaW5mb2JveElEID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBsYW5pdC1tYXJrZXInKS5hdHRyKCdkYXRhLWluZm9ib3gnKVxuICAgICQoXCIjI3tpbmZvYm94SUR9XCIpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuXG4gIG1vdXNldXA6IChlKSA9PlxuICAgIGlmICQoZS50YXJnZXQpLmhhc0NsYXNzKCdwbGFuaXQtbWFya2VyLWNvbnRlbnQnKVxuICAgICAgbWFya2VyID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBsYW5pdC1tYXJrZXInKVxuICAgICAgJChcIiMje21hcmtlci5hdHRyKCdkYXRhLWluZm9ib3gnKX1cIikuYWRkQ2xhc3MoJ2FjdGl2ZScpXG4gICAgQGRyYWdnaW5nTWFya2VyKCkucmVtb3ZlQ2xhc3MoJ2lzLWRyYWdnaW5nJylcblxuICBtb3VzZW1vdmU6IChlKSA9PlxuICAgIG1hcmtlcnMgPSBAbWFya2Vyc0NvbnRhaW5lci5maW5kKCcucGxhbml0LW1hcmtlci5pcy1kcmFnZ2luZycpXG4gICAgaWYgbWFya2Vycy5sZW5ndGggPiAwXG5cbiAgICAgICMgb25seSB1c2UgZmlyc3QgbWFya2VyIGluIGNhc2UgdGhlcmUgYXJlIG1vcmUgdGhhblxuICAgICAgIyBvbmUgZHJhZ2dpbmdcbiAgICAgICMgXG4gICAgICBtYXJrZXIgPSBtYXJrZXJzLmZpcnN0KClcblxuICAgICAgIyBjYWxjdWxhdGUgcG9zaXRpb25zXG4gICAgICAjIFxuICAgICAgbW91c2VMZWZ0ICAgICA9IGUucGFnZVggLSBAcGxhbi5vZmZzZXQoKS5sZWZ0XG4gICAgICBtb3VzZVRvcCAgICAgID0gZS5wYWdlWSAtIEBwbGFuLm9mZnNldCgpLnRvcFxuICAgICAgcGxhblJpZ2h0ICAgICA9IEBwbGFuLndpZHRoKClcbiAgICAgIHBsYW5Cb3R0b20gICAgPSBAcGxhbi5oZWlnaHQoKVxuICAgICAgbWFya2VyTGVmdCAgICA9IG1vdXNlTGVmdCAtIChtYXJrZXIub3V0ZXJXaWR0aCgpIC8gMilcbiAgICAgIG1hcmtlclRvcCAgICAgPSBtb3VzZVRvcCAtIChtYXJrZXIub3V0ZXJIZWlnaHQoKSAvIDIpXG4gICAgICBtYXJrZXJSaWdodCAgID0gbW91c2VMZWZ0ICsgKG1hcmtlci5vdXRlcldpZHRoKCkgLyAyKVxuICAgICAgbWFya2VyQm90dG9tICA9IG1vdXNlVG9wICsgKG1hcmtlci5vdXRlckhlaWdodCgpIC8gMilcbiAgICAgIG1hcmtlcldpZHRoICAgPSBtYXJrZXIub3V0ZXJXaWR0aCgpXG4gICAgICBtYXJrZXJIZWlnaHQgID0gbWFya2VyLm91dGVySGVpZ2h0KClcblxuICAgICAgIyBmaW5kIHRoZSBsZWZ0IHBvc2l0aW9uIG9mIHRoZSBtYXJrZXIgYmFzZWQgb25cbiAgICAgICMgcG9zaXRpb24gb2YgdGhlIG1vdXNlIHJlbGF0aXZlIHRvIHRoZSBwbGFuXG4gICAgICAjIFxuICAgICAgaWYgbWFya2VyTGVmdCA8PSAwXG4gICAgICAgIG1hcmtlclggPSAwXG4gICAgICBlbHNlIGlmIG1hcmtlclJpZ2h0IDwgcGxhblJpZ2h0XG4gICAgICAgIG1hcmtlclggPSBtYXJrZXJMZWZ0XG4gICAgICBlbHNlXG4gICAgICAgIG1hcmtlclggPSBwbGFuUmlnaHQgLSBtYXJrZXJXaWR0aFxuXG4gICAgICAjIGZpbmQgdGhlIGxlZnQgcG9zaXRpb24gb2YgdGhlIG1hcmtlciBiYXNlZCBvblxuICAgICAgIyBwb3NpdGlvbiBvZiB0aGUgbW91c2UgcmVsYXRpdmUgdG8gdGhlIHBsYW5cbiAgICAgICMgXG4gICAgICBpZiBtYXJrZXJUb3AgPD0gMFxuICAgICAgICBtYXJrZXJZID0gMFxuICAgICAgZWxzZSBpZiBtYXJrZXJCb3R0b20gPCBwbGFuQm90dG9tXG4gICAgICAgIG1hcmtlclkgPSBtYXJrZXJUb3BcbiAgICAgIGVsc2VcbiAgICAgICAgbWFya2VyWSA9IHBsYW5Cb3R0b20gLSBtYXJrZXJIZWlnaHRcblxuICAgICAgIyBzZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBtYXJrZXJcbiAgICAgICMgXG4gICAgICBtYXJrZXIuY3NzXG4gICAgICAgIGxlZnQ6IG1hcmtlclhcbiAgICAgICAgdG9wOiBtYXJrZXJZXG5cbiAgYmluZERyYWdnYWJsZTogLT5cbiAgICAkKGRvY3VtZW50KS5vbignbW91c2Vtb3ZlJywgQG1vdXNlbW92ZSlcbiAgICAkKGRvY3VtZW50KS5vbignbW91c2V1cCcsIEBtb3VzZXVwKVxuXG4gIG1hcmtlcnM6IC0+XG4gICAgQG1hcmtlcnNDb250YWluZXIuZmluZCgnLnBsYW5pdC1tYXJrZXInKVxuXG4gIGRyYWdnaW5nTWFya2VyOiAtPlxuICAgIEBtYXJrZXJzQ29udGFpbmVyLmZpbmQoJy5wbGFuaXQtbWFya2VyLmlzLWRyYWdnaW5nJylcblxuICBsYXN0TWFya2VyOiAtPlxuICAgIEBtYXJrZXJzKCkubGFzdCgpXG5cbiAgcmFuZG9tU3RyaW5nOiAobGVuZ3RoID0gMTYpIC0+XG4gICAgc3RyID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMikgXG4gICAgc3RyID0gc3RyICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMilcbiAgICBzdHIuc3Vic3RyaW5nKDAsIGxlbmd0aCAtIDEpXG4iXX0=