var Planit,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Planit = (function() {
  function Planit() {
    this.initMarkers = __bind(this.initMarkers, this);
  }

  Planit.prototype["new"] = function(_at_options) {
    this.options = _at_options;
    if (!this.options) {
      this.options = {};
    }
    this.setOptions();
    this.initPlan();
    if (this.options.markers) {
      return $(window).load(this.initMarkers);
    }
  };

  Planit.prototype.setOptions = function() {
    this.setDefaultOptions();
    if (this.options.container) {
      this.planOptions.container = $("#" + this.options.container);
    }
    if (this.options.backgroundImage) {
      return this.planOptions.backgroundImage = this.options.backgroundImage;
    }
  };

  Planit.prototype.setDefaultOptions = function() {
    return this.planOptions = {
      container: $('#planit')
    };
  };

  Planit.prototype.initPlan = function() {
    return this.plan = new Planit.Plan(this.planOptions);
  };

  Planit.prototype.initMarkers = function() {
    var marker, _i, _len, _ref, _results;
    this.markers = new Planit.Marker({
      plan: this.planOptions.container
    });
    _ref = this.options.markers;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      marker = _ref[_i];
      _results.push(this.markers.add(marker));
    }
    return _results;
  };

  return Planit;

})();

window.planit = new Planit;

Planit.Plan = (function() {
  function Plan(_at_options) {
    this.options = _at_options;
    this.initContainers();
    if (this.options.backgroundImage) {
      this.addBackgroundImage();
    }
  }

  Plan.prototype.initContainers = function() {
    this.options.container.addClass('planit-container');
    return this.options.container.append("<div class=\"planit-markers-container\"></div>");
  };

  Plan.prototype.addBackgroundImage = function() {
    this.options.container.append("<img src=\"" + this.options.backgroundImage + "\">");
    this.options.container.find('.planit-markers-container').css({
      backgroundImage: "url('" + this.options.backgroundImage + "')"
    });
    return $(window).load((function(_this) {
      return function() {
        _this.options.container.css({
          height: _this.options.container.find('img').first().height()
        });
        return _this.options.container.find('img').first().remove();
      };
    })(this));
  };

  return Plan;

})();

Planit.Marker = (function() {
  function Marker(_at_options) {
    this.options = _at_options;
    this.mousemove = __bind(this.mousemove, this);
    this.mouseup = __bind(this.mouseup, this);
    this.mousedown = __bind(this.mousedown, this);
    this.setOptions();
    this.bindDraggable();
  }

  Marker.prototype.setOptions = function() {
    this.plan = this.options.plan;
    return this.markersContainer = this.plan.find('.planit-markers-container');
  };

  Marker.prototype.add = function(options) {
    var id, infobox;
    this.markersContainer.append($('<div><div class="planit-marker-content"></div></div>').addClass('planit-marker').css({
      left: options.coords[0] + "%",
      top: options.coords[1] + "%"
    }));
    if (options.draggable) {
      this.lastMarker().addClass('draggable');
      this.lastMarker().on('mousedown', this.mousedown);
    }
    if (options.infobox) {
      id = this.randomString(16);
      this.lastMarker().find('.planit-marker-content').append("<div class=\"planit-infobox\" id=\"info-" + id + "\">" + options.infobox + "</div>");
      this.lastMarker().attr('data-infobox', "info-" + id);
      infobox = $("#" + (this.lastMarker().attr('data-infobox')));
      infobox.css({
        left: -(infobox.width() / 2),
        bottom: infobox.outerHeight() + 5
      });
      this.lastMarker().on('mouseleave', (function(_this) {
        return function(e) {
          var marker;
          marker = $(e.target).closest('.planit-marker');
          infobox = $("#" + (marker.attr('data-infobox')));
          return infobox.removeClass('active');
        };
      })(this));
      return this.lastMarker().on('mouseover', (function(_this) {
        return function(e) {
          var marker;
          marker = $(e.target).closest('.planit-marker');
          infobox = $("#" + (marker.attr('data-infobox')));
          if (marker.hasClass('is-dragging') || _this.draggingMarker().length > 0) {
            return infobox.removeClass('active');
          } else {
            return infobox.addClass('active');
          }
        };
      })(this));
    }
  };

  Marker.prototype.mousedown = function(e) {
    var infoboxID, marker;
    marker = $(e.target).closest('.planit-marker');
    marker.addClass('is-dragging');
    infoboxID = $(e.target).closest('.planit-marker').attr('data-infobox');
    return $("#" + infoboxID).removeClass('active');
  };

  Marker.prototype.mouseup = function(e) {
    var marker;
    if ($(e.target).hasClass('planit-marker-content')) {
      marker = $(e.target).closest('.planit-marker');
      $("#" + (marker.attr('data-infobox'))).addClass('active');
    }
    return this.draggingMarker().removeClass('is-dragging');
  };

  Marker.prototype.mousemove = function(e) {
    var marker, markerBottom, markerHeight, markerLeft, markerRight, markerTop, markerWidth, markerX, markerY, markers, mouseLeft, mouseTop, planBottom, planRight;
    markers = this.markersContainer.find('.planit-marker.is-dragging');
    if (markers.length > 0) {
      marker = markers.first();
      mouseLeft = e.pageX - this.plan.offset().left;
      mouseTop = e.pageY - this.plan.offset().top;
      planRight = this.plan.width();
      planBottom = this.plan.height();
      markerLeft = mouseLeft - (marker.outerWidth() / 2);
      markerTop = mouseTop - (marker.outerHeight() / 2);
      markerRight = mouseLeft + (marker.outerWidth() / 2);
      markerBottom = mouseTop + (marker.outerHeight() / 2);
      markerWidth = marker.outerWidth();
      markerHeight = marker.outerHeight();
      if (markerLeft <= 0) {
        markerX = 0;
      } else if (markerRight < planRight) {
        markerX = markerLeft;
      } else {
        markerX = planRight - markerWidth;
      }
      if (markerTop <= 0) {
        markerY = 0;
      } else if (markerBottom < planBottom) {
        markerY = markerTop;
      } else {
        markerY = planBottom - markerHeight;
      }
      return marker.css({
        left: markerX,
        top: markerY
      });
    }
  };

  Marker.prototype.bindDraggable = function() {
    $(document).on('mousemove', this.mousemove);
    return $(document).on('mouseup', this.mouseup);
  };

  Marker.prototype.markers = function() {
    return this.markersContainer.find('.planit-marker');
  };

  Marker.prototype.draggingMarker = function() {
    return this.markersContainer.find('.planit-marker.is-dragging');
  };

  Marker.prototype.lastMarker = function() {
    return this.markers().last();
  };

  Marker.prototype.randomString = function(length) {
    var str;
    if (length == null) {
      length = 16;
    }
    str = Math.random().toString(36).slice(2);
    str = str + Math.random().toString(36).slice(2);
    return str.substring(0, length - 1);
  };

  return Marker;

})();

//# sourceMappingURL=data:application/json;base64,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b3VyY2VzQ29udGVudCI6WyJjbGFzcyBQbGFuaXRcblxuICBuZXc6IChAb3B0aW9ucykgLT5cbiAgICBAb3B0aW9ucyA9IHt9IHVubGVzcyBAb3B0aW9uc1xuICAgIEBzZXRPcHRpb25zKClcbiAgICBAaW5pdFBsYW4oKVxuICAgIGlmIEBvcHRpb25zLm1hcmtlcnNcbiAgICAgICQod2luZG93KS5sb2FkKEBpbml0TWFya2VycylcblxuICBzZXRPcHRpb25zOiAtPlxuICAgIEBzZXREZWZhdWx0T3B0aW9ucygpXG4gICAgQHBsYW5PcHRpb25zLmNvbnRhaW5lciA9ICQoXCIjI3tAb3B0aW9ucy5jb250YWluZXJ9XCIpIGlmIEBvcHRpb25zLmNvbnRhaW5lclxuICAgIEBwbGFuT3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2UgPSBAb3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2UgaWYgQG9wdGlvbnMuYmFja2dyb3VuZEltYWdlXG5cbiAgc2V0RGVmYXVsdE9wdGlvbnM6IC0+XG4gICAgQHBsYW5PcHRpb25zID1cbiAgICAgIGNvbnRhaW5lcjogJCgnI3BsYW5pdCcpXG5cbiAgaW5pdFBsYW46IC0+XG4gICAgQHBsYW4gPSBuZXcgUGxhbml0LlBsYW4oQHBsYW5PcHRpb25zKVxuXG4gIGluaXRNYXJrZXJzOiA9PlxuICAgIEBtYXJrZXJzID0gbmV3IFBsYW5pdC5NYXJrZXJcbiAgICAgIHBsYW46IEBwbGFuT3B0aW9ucy5jb250YWluZXJcbiAgICBmb3IgbWFya2VyIGluIEBvcHRpb25zLm1hcmtlcnNcbiAgICAgIEBtYXJrZXJzLmFkZChtYXJrZXIpXG5cbndpbmRvdy5wbGFuaXQgPSBuZXcgUGxhbml0XG5cbmNsYXNzIFBsYW5pdC5QbGFuXG5cbiAgY29uc3RydWN0b3I6IChAb3B0aW9ucykgLT5cbiAgICBAaW5pdENvbnRhaW5lcnMoKVxuICAgIEBhZGRCYWNrZ3JvdW5kSW1hZ2UoKSBpZiBAb3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2VcblxuICBpbml0Q29udGFpbmVyczogLT5cbiAgICBAb3B0aW9ucy5jb250YWluZXIuYWRkQ2xhc3MoJ3BsYW5pdC1jb250YWluZXInKVxuICAgIEBvcHRpb25zLmNvbnRhaW5lci5hcHBlbmQoXCJcIlwiPGRpdiBjbGFzcz1cInBsYW5pdC1tYXJrZXJzLWNvbnRhaW5lclwiPjwvZGl2PlwiXCJcIilcblxuICBhZGRCYWNrZ3JvdW5kSW1hZ2U6IC0+XG4gICAgQG9wdGlvbnMuY29udGFpbmVyLmFwcGVuZChcIlwiXCI8aW1nIHNyYz1cIiN7QG9wdGlvbnMuYmFja2dyb3VuZEltYWdlfVwiPlwiXCJcIilcbiAgICBAb3B0aW9ucy5jb250YWluZXIuZmluZCgnLnBsYW5pdC1tYXJrZXJzLWNvbnRhaW5lcicpLmNzc1xuICAgICAgYmFja2dyb3VuZEltYWdlOiBcInVybCgnI3tAb3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2V9JylcIlxuICAgICQod2luZG93KS5sb2FkID0+XG4gICAgICBAb3B0aW9ucy5jb250YWluZXIuY3NzXG4gICAgICAgIGhlaWdodDogQG9wdGlvbnMuY29udGFpbmVyLmZpbmQoJ2ltZycpLmZpcnN0KCkuaGVpZ2h0KClcbiAgICAgIEBvcHRpb25zLmNvbnRhaW5lci5maW5kKCdpbWcnKS5maXJzdCgpLnJlbW92ZSgpXG5cblxuY2xhc3MgUGxhbml0Lk1hcmtlclxuXG4gIGNvbnN0cnVjdG9yOiAoQG9wdGlvbnMpIC0+XG4gICAgQHNldE9wdGlvbnMoKVxuICAgIEBiaW5kRHJhZ2dhYmxlKClcblxuICBzZXRPcHRpb25zOiAtPlxuICAgIEBwbGFuID0gQG9wdGlvbnMucGxhblxuICAgIEBtYXJrZXJzQ29udGFpbmVyID0gQHBsYW4uZmluZCgnLnBsYW5pdC1tYXJrZXJzLWNvbnRhaW5lcicpXG5cbiAgYWRkOiAob3B0aW9ucykgLT5cbiAgICBAbWFya2Vyc0NvbnRhaW5lci5hcHBlbmQoXG4gICAgICAkKCc8ZGl2PjxkaXYgY2xhc3M9XCJwbGFuaXQtbWFya2VyLWNvbnRlbnRcIj48L2Rpdj48L2Rpdj4nKVxuICAgICAgICAuYWRkQ2xhc3MoJ3BsYW5pdC1tYXJrZXInKVxuICAgICAgICAuY3NzXG4gICAgICAgICAgbGVmdDogXCIje29wdGlvbnMuY29vcmRzWzBdfSVcIlxuICAgICAgICAgIHRvcDogXCIje29wdGlvbnMuY29vcmRzWzFdfSVcIlxuICAgIClcbiAgICBpZiBvcHRpb25zLmRyYWdnYWJsZVxuICAgICAgQGxhc3RNYXJrZXIoKS5hZGRDbGFzcygnZHJhZ2dhYmxlJylcbiAgICAgIEBsYXN0TWFya2VyKCkub24oJ21vdXNlZG93bicsIEBtb3VzZWRvd24pXG4gICAgaWYgb3B0aW9ucy5pbmZvYm94XG4gICAgICBpZCA9IEByYW5kb21TdHJpbmcoMTYpXG4gICAgICBAbGFzdE1hcmtlcigpLmZpbmQoJy5wbGFuaXQtbWFya2VyLWNvbnRlbnQnKS5hcHBlbmQgXCJcIlwiXG4gICAgICAgIDxkaXYgY2xhc3M9XCJwbGFuaXQtaW5mb2JveFwiIGlkPVwiaW5mby0je2lkfVwiPiN7b3B0aW9ucy5pbmZvYm94fTwvZGl2PlxuICAgICAgICAgIFwiXCJcIlxuICAgICAgQGxhc3RNYXJrZXIoKS5hdHRyKCdkYXRhLWluZm9ib3gnLCBcImluZm8tI3tpZH1cIilcbiAgICAgIGluZm9ib3ggPSAkKFwiIyN7QGxhc3RNYXJrZXIoKS5hdHRyKCdkYXRhLWluZm9ib3gnKX1cIilcbiAgICAgIGluZm9ib3guY3NzXG4gICAgICAgIGxlZnQ6IC0oaW5mb2JveC53aWR0aCgpIC8gMilcbiAgICAgICAgYm90dG9tOiBpbmZvYm94Lm91dGVySGVpZ2h0KCkgKyA1XG4gICAgICBAbGFzdE1hcmtlcigpLm9uICdtb3VzZWxlYXZlJywgKGUpID0+XG4gICAgICAgIG1hcmtlciA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5wbGFuaXQtbWFya2VyJylcbiAgICAgICAgaW5mb2JveCA9ICQoXCIjI3ttYXJrZXIuYXR0cignZGF0YS1pbmZvYm94Jyl9XCIpXG4gICAgICAgIGluZm9ib3gucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXG4gICAgICBAbGFzdE1hcmtlcigpLm9uICdtb3VzZW92ZXInLCAoZSkgPT5cbiAgICAgICAgbWFya2VyID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBsYW5pdC1tYXJrZXInKVxuICAgICAgICBpbmZvYm94ID0gJChcIiMje21hcmtlci5hdHRyKCdkYXRhLWluZm9ib3gnKX1cIilcbiAgICAgICAgaWYgbWFya2VyLmhhc0NsYXNzKCdpcy1kcmFnZ2luZycpIHx8IEBkcmFnZ2luZ01hcmtlcigpLmxlbmd0aCA+IDBcbiAgICAgICAgICBpbmZvYm94LnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgaW5mb2JveC5hZGRDbGFzcygnYWN0aXZlJylcblxuICBtb3VzZWRvd246IChlKSA9PlxuICAgIG1hcmtlciA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5wbGFuaXQtbWFya2VyJylcbiAgICBtYXJrZXIuYWRkQ2xhc3MoJ2lzLWRyYWdnaW5nJylcbiAgICBpbmZvYm94SUQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcucGxhbml0LW1hcmtlcicpLmF0dHIoJ2RhdGEtaW5mb2JveCcpXG4gICAgJChcIiMje2luZm9ib3hJRH1cIikucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXG5cbiAgbW91c2V1cDogKGUpID0+XG4gICAgaWYgJChlLnRhcmdldCkuaGFzQ2xhc3MoJ3BsYW5pdC1tYXJrZXItY29udGVudCcpXG4gICAgICBtYXJrZXIgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcucGxhbml0LW1hcmtlcicpXG4gICAgICAkKFwiIyN7bWFya2VyLmF0dHIoJ2RhdGEtaW5mb2JveCcpfVwiKS5hZGRDbGFzcygnYWN0aXZlJylcbiAgICBAZHJhZ2dpbmdNYXJrZXIoKS5yZW1vdmVDbGFzcygnaXMtZHJhZ2dpbmcnKVxuXG4gIG1vdXNlbW92ZTogKGUpID0+XG4gICAgbWFya2VycyA9IEBtYXJrZXJzQ29udGFpbmVyLmZpbmQoJy5wbGFuaXQtbWFya2VyLmlzLWRyYWdnaW5nJylcbiAgICBpZiBtYXJrZXJzLmxlbmd0aCA+IDBcblxuICAgICAgIyBvbmx5IHVzZSBmaXJzdCBtYXJrZXIgaW4gY2FzZSB0aGVyZSBhcmUgbW9yZSB0aGFuXG4gICAgICAjIG9uZSBkcmFnZ2luZ1xuICAgICAgIyBcbiAgICAgIG1hcmtlciA9IG1hcmtlcnMuZmlyc3QoKVxuXG4gICAgICAjIGNhbGN1bGF0ZSBwb3NpdGlvbnNcbiAgICAgICMgXG4gICAgICBtb3VzZUxlZnQgICAgID0gZS5wYWdlWCAtIEBwbGFuLm9mZnNldCgpLmxlZnRcbiAgICAgIG1vdXNlVG9wICAgICAgPSBlLnBhZ2VZIC0gQHBsYW4ub2Zmc2V0KCkudG9wXG4gICAgICBwbGFuUmlnaHQgICAgID0gQHBsYW4ud2lkdGgoKVxuICAgICAgcGxhbkJvdHRvbSAgICA9IEBwbGFuLmhlaWdodCgpXG4gICAgICBtYXJrZXJMZWZ0ICAgID0gbW91c2VMZWZ0IC0gKG1hcmtlci5vdXRlcldpZHRoKCkgLyAyKVxuICAgICAgbWFya2VyVG9wICAgICA9IG1vdXNlVG9wIC0gKG1hcmtlci5vdXRlckhlaWdodCgpIC8gMilcbiAgICAgIG1hcmtlclJpZ2h0ICAgPSBtb3VzZUxlZnQgKyAobWFya2VyLm91dGVyV2lkdGgoKSAvIDIpXG4gICAgICBtYXJrZXJCb3R0b20gID0gbW91c2VUb3AgKyAobWFya2VyLm91dGVySGVpZ2h0KCkgLyAyKVxuICAgICAgbWFya2VyV2lkdGggICA9IG1hcmtlci5vdXRlcldpZHRoKClcbiAgICAgIG1hcmtlckhlaWdodCAgPSBtYXJrZXIub3V0ZXJIZWlnaHQoKVxuXG4gICAgICAjIGZpbmQgdGhlIGxlZnQgcG9zaXRpb24gb2YgdGhlIG1hcmtlciBiYXNlZCBvblxuICAgICAgIyBwb3NpdGlvbiBvZiB0aGUgbW91c2UgcmVsYXRpdmUgdG8gdGhlIHBsYW5cbiAgICAgICMgXG4gICAgICBpZiBtYXJrZXJMZWZ0IDw9IDBcbiAgICAgICAgbWFya2VyWCA9IDBcbiAgICAgIGVsc2UgaWYgbWFya2VyUmlnaHQgPCBwbGFuUmlnaHRcbiAgICAgICAgbWFya2VyWCA9IG1hcmtlckxlZnRcbiAgICAgIGVsc2VcbiAgICAgICAgbWFya2VyWCA9IHBsYW5SaWdodCAtIG1hcmtlcldpZHRoXG5cbiAgICAgICMgZmluZCB0aGUgbGVmdCBwb3NpdGlvbiBvZiB0aGUgbWFya2VyIGJhc2VkIG9uXG4gICAgICAjIHBvc2l0aW9uIG9mIHRoZSBtb3VzZSByZWxhdGl2ZSB0byB0aGUgcGxhblxuICAgICAgIyBcbiAgICAgIGlmIG1hcmtlclRvcCA8PSAwXG4gICAgICAgIG1hcmtlclkgPSAwXG4gICAgICBlbHNlIGlmIG1hcmtlckJvdHRvbSA8IHBsYW5Cb3R0b21cbiAgICAgICAgbWFya2VyWSA9IG1hcmtlclRvcFxuICAgICAgZWxzZVxuICAgICAgICBtYXJrZXJZID0gcGxhbkJvdHRvbSAtIG1hcmtlckhlaWdodFxuXG4gICAgICAjIHNldCB0aGUgcG9zaXRpb24gb2YgdGhlIG1hcmtlclxuICAgICAgIyBcbiAgICAgIG1hcmtlci5jc3NcbiAgICAgICAgbGVmdDogbWFya2VyWFxuICAgICAgICB0b3A6IG1hcmtlcllcblxuICBiaW5kRHJhZ2dhYmxlOiAtPlxuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZW1vdmUnLCBAbW91c2Vtb3ZlKVxuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwJywgQG1vdXNldXApXG5cbiAgbWFya2VyczogLT5cbiAgICBAbWFya2Vyc0NvbnRhaW5lci5maW5kKCcucGxhbml0LW1hcmtlcicpXG5cbiAgZHJhZ2dpbmdNYXJrZXI6IC0+XG4gICAgQG1hcmtlcnNDb250YWluZXIuZmluZCgnLnBsYW5pdC1tYXJrZXIuaXMtZHJhZ2dpbmcnKVxuXG4gIGxhc3RNYXJrZXI6IC0+XG4gICAgQG1hcmtlcnMoKS5sYXN0KClcblxuICByYW5kb21TdHJpbmc6IChsZW5ndGggPSAxNikgLT5cbiAgICBzdHIgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKSBcbiAgICBzdHIgPSBzdHIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKVxuICAgIHN0ci5zdWJzdHJpbmcoMCwgbGVuZ3RoIC0gMSlcbiJdfQ==