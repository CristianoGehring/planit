var Planit,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Planit = (function() {
  function Planit() {
    this.addMarker = __bind(this.addMarker, this);
    this.initMarkers = __bind(this.initMarkers, this);
  }

  Planit.prototype["new"] = function(_at_options) {
    this.options = _at_options;
    if (!this.options) {
      this.options = {};
    }
    this.setOptions();
    this.initPlan();
    $(window).load(this.initMarkers);
    return this;
  };

  Planit.prototype.setOptions = function() {
    this.setDefaultOptions();
    if (this.options.container) {
      this.planOptions.container = $("#" + this.options.container);
    }
    if (this.options.backgroundImage) {
      return this.planOptions.backgroundImage = this.options.backgroundImage;
    }
  };

  Planit.prototype.setDefaultOptions = function() {
    return this.planOptions = {
      container: $('#planit')
    };
  };

  Planit.prototype.initPlan = function() {
    return this.plan = new Planit.Plan(this.planOptions);
  };

  Planit.prototype.initMarkers = function() {
    var marker, _i, _len, _ref, _results;
    this.markers = new Planit.Marker({
      plan: this.planOptions.container
    });
    if (this.options.markers) {
      _ref = this.options.markers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        marker = _ref[_i];
        _results.push(this.markers.add(marker));
      }
      return _results;
    }
  };

  Planit.prototype.addMarker = function(options) {
    return this.markers.add(options);
  };

  return Planit;

})();

window.planit = new Planit;

Planit.Plan = (function() {
  function Plan(_at_options) {
    this.options = _at_options;
    this.initContainers();
    if (this.options.backgroundImage) {
      this.addBackgroundImage();
    }
  }

  Plan.prototype.initContainers = function() {
    this.options.container.addClass('planit-container');
    return this.options.container.append("<div class=\"planit-markers-container\"></div>");
  };

  Plan.prototype.addBackgroundImage = function() {
    this.options.container.append("<img src=\"" + this.options.backgroundImage + "\">");
    this.options.container.find('.planit-markers-container').css({
      backgroundImage: "url('" + this.options.backgroundImage + "')"
    });
    return $(window).load((function(_this) {
      return function() {
        _this.options.container.css({
          height: _this.options.container.find('img').first().height()
        });
        return _this.options.container.find('img').first().remove();
      };
    })(this));
  };

  return Plan;

})();

Planit.Marker = (function() {
  function Marker(_at_options) {
    this.options = _at_options;
    this.mousemove = __bind(this.mousemove, this);
    this.mouseup = __bind(this.mouseup, this);
    this.mousedown = __bind(this.mousedown, this);
    this.setOptions();
    this.bindDraggable();
  }

  Marker.prototype.setOptions = function() {
    this.plan = this.options.plan;
    return this.markersContainer = this.plan.find('.planit-markers-container');
  };

  Marker.prototype.add = function(options) {
    var id, infobox;
    this.markersContainer.append($('<div><div class="planit-marker-content"></div></div>').addClass('planit-marker').css({
      left: options.coords[0] + "%",
      top: options.coords[1] + "%"
    }));
    if (options.draggable) {
      this.lastMarker().addClass('draggable');
      this.lastMarker().on('mousedown', this.mousedown);
    }
    if (options.infobox) {
      id = this.randomString(16);
      this.lastMarker().find('.planit-marker-content').append("<div class=\"planit-infobox\" id=\"info-" + id + "\">" + options.infobox + "</div>");
      this.lastMarker().attr('data-infobox', "info-" + id);
      infobox = $("#" + (this.lastMarker().attr('data-infobox')));
      infobox.css({
        left: -(infobox.width() / 2),
        bottom: infobox.outerHeight() + 5
      });
      this.lastMarker().on('mouseleave', (function(_this) {
        return function(e) {
          var marker;
          marker = $(e.target).closest('.planit-marker');
          infobox = $("#" + (marker.attr('data-infobox')));
          return infobox.removeClass('active');
        };
      })(this));
      return this.lastMarker().on('mouseover', (function(_this) {
        return function(e) {
          var marker;
          marker = $(e.target).closest('.planit-marker');
          infobox = $("#" + (marker.attr('data-infobox')));
          if (marker.hasClass('is-dragging') || _this.draggingMarker().length > 0) {
            return infobox.removeClass('active');
          } else {
            return infobox.addClass('active');
          }
        };
      })(this));
    }
  };

  Marker.prototype.mousedown = function(e) {
    var infoboxID, marker;
    marker = $(e.target).closest('.planit-marker');
    marker.addClass('is-dragging');
    infoboxID = $(e.target).closest('.planit-marker').attr('data-infobox');
    return $("#" + infoboxID).removeClass('active');
  };

  Marker.prototype.mouseup = function(e) {
    var marker;
    if ($(e.target).hasClass('planit-marker-content')) {
      marker = $(e.target).closest('.planit-marker');
      $("#" + (marker.attr('data-infobox'))).addClass('active');
    }
    return this.draggingMarker().removeClass('is-dragging');
  };

  Marker.prototype.mousemove = function(e) {
    var marker, markerBottom, markerHeight, markerLeft, markerRight, markerTop, markerWidth, markerX, markerY, markers, mouseLeft, mouseTop, planBottom, planRight;
    markers = this.markersContainer.find('.planit-marker.is-dragging');
    if (markers.length > 0) {
      marker = markers.first();
      mouseLeft = e.pageX - this.plan.offset().left;
      mouseTop = e.pageY - this.plan.offset().top;
      planRight = this.plan.width();
      planBottom = this.plan.height();
      markerLeft = mouseLeft - (marker.outerWidth() / 2);
      markerTop = mouseTop - (marker.outerHeight() / 2);
      markerRight = mouseLeft + (marker.outerWidth() / 2);
      markerBottom = mouseTop + (marker.outerHeight() / 2);
      markerWidth = marker.outerWidth();
      markerHeight = marker.outerHeight();
      if (markerLeft <= 0) {
        markerX = 0;
      } else if (markerRight < planRight) {
        markerX = markerLeft;
      } else {
        markerX = planRight - markerWidth;
      }
      if (markerTop <= 0) {
        markerY = 0;
      } else if (markerBottom < planBottom) {
        markerY = markerTop;
      } else {
        markerY = planBottom - markerHeight;
      }
      return marker.css({
        left: markerX,
        top: markerY
      });
    }
  };

  Marker.prototype.bindDraggable = function() {
    $(document).on('mousemove', this.mousemove);
    return $(document).on('mouseup', this.mouseup);
  };

  Marker.prototype.markers = function() {
    return this.markersContainer.find('.planit-marker');
  };

  Marker.prototype.draggingMarker = function() {
    return this.markersContainer.find('.planit-marker.is-dragging');
  };

  Marker.prototype.lastMarker = function() {
    return this.markers().last();
  };

  Marker.prototype.randomString = function(length) {
    var str;
    if (length == null) {
      length = 16;
    }
    str = Math.random().toString(36).slice(2);
    str = str + Math.random().toString(36).slice(2);
    return str.substring(0, length - 1);
  };

  return Marker;

})();

//# sourceMappingURL=data:application/json;base64,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QWMsQ0FBZCxFQUFpQixNQUFBLEdBQVMsQ0FBMUIsRUFIWTtFQUFBLENBbEhkLENBQUE7O2dCQUFBOztJQXZERixDQUFBIiwiZmlsZSI6InBsYW5pdC10bXAuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBQbGFuaXRcblxuICBuZXc6IChAb3B0aW9ucykgLT5cbiAgICBAb3B0aW9ucyA9IHt9IHVubGVzcyBAb3B0aW9uc1xuICAgIEBzZXRPcHRpb25zKClcbiAgICBAaW5pdFBsYW4oKVxuICAgICQod2luZG93KS5sb2FkKEBpbml0TWFya2VycylcbiAgICBAXG5cbiAgc2V0T3B0aW9uczogLT5cbiAgICBAc2V0RGVmYXVsdE9wdGlvbnMoKVxuICAgIEBwbGFuT3B0aW9ucy5jb250YWluZXIgPSAkKFwiIyN7QG9wdGlvbnMuY29udGFpbmVyfVwiKSBpZiBAb3B0aW9ucy5jb250YWluZXJcbiAgICBAcGxhbk9wdGlvbnMuYmFja2dyb3VuZEltYWdlID0gQG9wdGlvbnMuYmFja2dyb3VuZEltYWdlIGlmIEBvcHRpb25zLmJhY2tncm91bmRJbWFnZVxuXG4gIHNldERlZmF1bHRPcHRpb25zOiAtPlxuICAgIEBwbGFuT3B0aW9ucyA9XG4gICAgICBjb250YWluZXI6ICQoJyNwbGFuaXQnKVxuXG4gIGluaXRQbGFuOiAtPlxuICAgIEBwbGFuID0gbmV3IFBsYW5pdC5QbGFuKEBwbGFuT3B0aW9ucylcblxuICBpbml0TWFya2VyczogPT5cbiAgICBAbWFya2VycyA9IG5ldyBQbGFuaXQuTWFya2VyXG4gICAgICBwbGFuOiBAcGxhbk9wdGlvbnMuY29udGFpbmVyXG4gICAgaWYgQG9wdGlvbnMubWFya2Vyc1xuICAgICAgZm9yIG1hcmtlciBpbiBAb3B0aW9ucy5tYXJrZXJzXG4gICAgICAgIEBtYXJrZXJzLmFkZChtYXJrZXIpXG5cbiAgYWRkTWFya2VyOiAob3B0aW9ucykgPT5cbiAgICBAbWFya2Vycy5hZGQob3B0aW9ucylcblxud2luZG93LnBsYW5pdCA9IG5ldyBQbGFuaXRcblxuY2xhc3MgUGxhbml0LlBsYW5cblxuICBjb25zdHJ1Y3RvcjogKEBvcHRpb25zKSAtPlxuICAgIEBpbml0Q29udGFpbmVycygpXG4gICAgQGFkZEJhY2tncm91bmRJbWFnZSgpIGlmIEBvcHRpb25zLmJhY2tncm91bmRJbWFnZVxuXG4gIGluaXRDb250YWluZXJzOiAtPlxuICAgIEBvcHRpb25zLmNvbnRhaW5lci5hZGRDbGFzcygncGxhbml0LWNvbnRhaW5lcicpXG4gICAgQG9wdGlvbnMuY29udGFpbmVyLmFwcGVuZChcIlwiXCI8ZGl2IGNsYXNzPVwicGxhbml0LW1hcmtlcnMtY29udGFpbmVyXCI+PC9kaXY+XCJcIlwiKVxuXG4gIGFkZEJhY2tncm91bmRJbWFnZTogLT5cbiAgICBAb3B0aW9ucy5jb250YWluZXIuYXBwZW5kKFwiXCJcIjxpbWcgc3JjPVwiI3tAb3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2V9XCI+XCJcIlwiKVxuICAgIEBvcHRpb25zLmNvbnRhaW5lci5maW5kKCcucGxhbml0LW1hcmtlcnMtY29udGFpbmVyJykuY3NzXG4gICAgICBiYWNrZ3JvdW5kSW1hZ2U6IFwidXJsKCcje0BvcHRpb25zLmJhY2tncm91bmRJbWFnZX0nKVwiXG4gICAgJCh3aW5kb3cpLmxvYWQgPT5cbiAgICAgIEBvcHRpb25zLmNvbnRhaW5lci5jc3NcbiAgICAgICAgaGVpZ2h0OiBAb3B0aW9ucy5jb250YWluZXIuZmluZCgnaW1nJykuZmlyc3QoKS5oZWlnaHQoKVxuICAgICAgQG9wdGlvbnMuY29udGFpbmVyLmZpbmQoJ2ltZycpLmZpcnN0KCkucmVtb3ZlKClcblxuXG5jbGFzcyBQbGFuaXQuTWFya2VyXG5cbiAgY29uc3RydWN0b3I6IChAb3B0aW9ucykgLT5cbiAgICBAc2V0T3B0aW9ucygpXG4gICAgQGJpbmREcmFnZ2FibGUoKVxuXG4gIHNldE9wdGlvbnM6IC0+XG4gICAgQHBsYW4gPSBAb3B0aW9ucy5wbGFuXG4gICAgQG1hcmtlcnNDb250YWluZXIgPSBAcGxhbi5maW5kKCcucGxhbml0LW1hcmtlcnMtY29udGFpbmVyJylcblxuICBhZGQ6IChvcHRpb25zKSAtPlxuICAgIEBtYXJrZXJzQ29udGFpbmVyLmFwcGVuZChcbiAgICAgICQoJzxkaXY+PGRpdiBjbGFzcz1cInBsYW5pdC1tYXJrZXItY29udGVudFwiPjwvZGl2PjwvZGl2PicpXG4gICAgICAgIC5hZGRDbGFzcygncGxhbml0LW1hcmtlcicpXG4gICAgICAgIC5jc3NcbiAgICAgICAgICBsZWZ0OiBcIiN7b3B0aW9ucy5jb29yZHNbMF19JVwiXG4gICAgICAgICAgdG9wOiBcIiN7b3B0aW9ucy5jb29yZHNbMV19JVwiXG4gICAgKVxuICAgIGlmIG9wdGlvbnMuZHJhZ2dhYmxlXG4gICAgICBAbGFzdE1hcmtlcigpLmFkZENsYXNzKCdkcmFnZ2FibGUnKVxuICAgICAgQGxhc3RNYXJrZXIoKS5vbignbW91c2Vkb3duJywgQG1vdXNlZG93bilcbiAgICBpZiBvcHRpb25zLmluZm9ib3hcbiAgICAgIGlkID0gQHJhbmRvbVN0cmluZygxNilcbiAgICAgIEBsYXN0TWFya2VyKCkuZmluZCgnLnBsYW5pdC1tYXJrZXItY29udGVudCcpLmFwcGVuZCBcIlwiXCJcbiAgICAgICAgPGRpdiBjbGFzcz1cInBsYW5pdC1pbmZvYm94XCIgaWQ9XCJpbmZvLSN7aWR9XCI+I3tvcHRpb25zLmluZm9ib3h9PC9kaXY+XG4gICAgICAgICAgXCJcIlwiXG4gICAgICBAbGFzdE1hcmtlcigpLmF0dHIoJ2RhdGEtaW5mb2JveCcsIFwiaW5mby0je2lkfVwiKVxuICAgICAgaW5mb2JveCA9ICQoXCIjI3tAbGFzdE1hcmtlcigpLmF0dHIoJ2RhdGEtaW5mb2JveCcpfVwiKVxuICAgICAgaW5mb2JveC5jc3NcbiAgICAgICAgbGVmdDogLShpbmZvYm94LndpZHRoKCkgLyAyKVxuICAgICAgICBib3R0b206IGluZm9ib3gub3V0ZXJIZWlnaHQoKSArIDVcbiAgICAgIEBsYXN0TWFya2VyKCkub24gJ21vdXNlbGVhdmUnLCAoZSkgPT5cbiAgICAgICAgbWFya2VyID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBsYW5pdC1tYXJrZXInKVxuICAgICAgICBpbmZvYm94ID0gJChcIiMje21hcmtlci5hdHRyKCdkYXRhLWluZm9ib3gnKX1cIilcbiAgICAgICAgaW5mb2JveC5yZW1vdmVDbGFzcygnYWN0aXZlJylcbiAgICAgIEBsYXN0TWFya2VyKCkub24gJ21vdXNlb3ZlcicsIChlKSA9PlxuICAgICAgICBtYXJrZXIgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcucGxhbml0LW1hcmtlcicpXG4gICAgICAgIGluZm9ib3ggPSAkKFwiIyN7bWFya2VyLmF0dHIoJ2RhdGEtaW5mb2JveCcpfVwiKVxuICAgICAgICBpZiBtYXJrZXIuaGFzQ2xhc3MoJ2lzLWRyYWdnaW5nJykgfHwgQGRyYWdnaW5nTWFya2VyKCkubGVuZ3RoID4gMFxuICAgICAgICAgIGluZm9ib3gucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICBpbmZvYm94LmFkZENsYXNzKCdhY3RpdmUnKVxuXG4gIG1vdXNlZG93bjogKGUpID0+XG4gICAgbWFya2VyID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBsYW5pdC1tYXJrZXInKVxuICAgIG1hcmtlci5hZGRDbGFzcygnaXMtZHJhZ2dpbmcnKVxuICAgIGluZm9ib3hJRCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5wbGFuaXQtbWFya2VyJykuYXR0cignZGF0YS1pbmZvYm94JylcbiAgICAkKFwiIyN7aW5mb2JveElEfVwiKS5yZW1vdmVDbGFzcygnYWN0aXZlJylcblxuICBtb3VzZXVwOiAoZSkgPT5cbiAgICBpZiAkKGUudGFyZ2V0KS5oYXNDbGFzcygncGxhbml0LW1hcmtlci1jb250ZW50JylcbiAgICAgIG1hcmtlciA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5wbGFuaXQtbWFya2VyJylcbiAgICAgICQoXCIjI3ttYXJrZXIuYXR0cignZGF0YS1pbmZvYm94Jyl9XCIpLmFkZENsYXNzKCdhY3RpdmUnKVxuICAgIEBkcmFnZ2luZ01hcmtlcigpLnJlbW92ZUNsYXNzKCdpcy1kcmFnZ2luZycpXG5cbiAgbW91c2Vtb3ZlOiAoZSkgPT5cbiAgICBtYXJrZXJzID0gQG1hcmtlcnNDb250YWluZXIuZmluZCgnLnBsYW5pdC1tYXJrZXIuaXMtZHJhZ2dpbmcnKVxuICAgIGlmIG1hcmtlcnMubGVuZ3RoID4gMFxuXG4gICAgICAjIG9ubHkgdXNlIGZpcnN0IG1hcmtlciBpbiBjYXNlIHRoZXJlIGFyZSBtb3JlIHRoYW5cbiAgICAgICMgb25lIGRyYWdnaW5nXG4gICAgICAjIFxuICAgICAgbWFya2VyID0gbWFya2Vycy5maXJzdCgpXG5cbiAgICAgICMgY2FsY3VsYXRlIHBvc2l0aW9uc1xuICAgICAgIyBcbiAgICAgIG1vdXNlTGVmdCAgICAgPSBlLnBhZ2VYIC0gQHBsYW4ub2Zmc2V0KCkubGVmdFxuICAgICAgbW91c2VUb3AgICAgICA9IGUucGFnZVkgLSBAcGxhbi5vZmZzZXQoKS50b3BcbiAgICAgIHBsYW5SaWdodCAgICAgPSBAcGxhbi53aWR0aCgpXG4gICAgICBwbGFuQm90dG9tICAgID0gQHBsYW4uaGVpZ2h0KClcbiAgICAgIG1hcmtlckxlZnQgICAgPSBtb3VzZUxlZnQgLSAobWFya2VyLm91dGVyV2lkdGgoKSAvIDIpXG4gICAgICBtYXJrZXJUb3AgICAgID0gbW91c2VUb3AgLSAobWFya2VyLm91dGVySGVpZ2h0KCkgLyAyKVxuICAgICAgbWFya2VyUmlnaHQgICA9IG1vdXNlTGVmdCArIChtYXJrZXIub3V0ZXJXaWR0aCgpIC8gMilcbiAgICAgIG1hcmtlckJvdHRvbSAgPSBtb3VzZVRvcCArIChtYXJrZXIub3V0ZXJIZWlnaHQoKSAvIDIpXG4gICAgICBtYXJrZXJXaWR0aCAgID0gbWFya2VyLm91dGVyV2lkdGgoKVxuICAgICAgbWFya2VySGVpZ2h0ICA9IG1hcmtlci5vdXRlckhlaWdodCgpXG5cbiAgICAgICMgZmluZCB0aGUgbGVmdCBwb3NpdGlvbiBvZiB0aGUgbWFya2VyIGJhc2VkIG9uXG4gICAgICAjIHBvc2l0aW9uIG9mIHRoZSBtb3VzZSByZWxhdGl2ZSB0byB0aGUgcGxhblxuICAgICAgIyBcbiAgICAgIGlmIG1hcmtlckxlZnQgPD0gMFxuICAgICAgICBtYXJrZXJYID0gMFxuICAgICAgZWxzZSBpZiBtYXJrZXJSaWdodCA8IHBsYW5SaWdodFxuICAgICAgICBtYXJrZXJYID0gbWFya2VyTGVmdFxuICAgICAgZWxzZVxuICAgICAgICBtYXJrZXJYID0gcGxhblJpZ2h0IC0gbWFya2VyV2lkdGhcblxuICAgICAgIyBmaW5kIHRoZSBsZWZ0IHBvc2l0aW9uIG9mIHRoZSBtYXJrZXIgYmFzZWQgb25cbiAgICAgICMgcG9zaXRpb24gb2YgdGhlIG1vdXNlIHJlbGF0aXZlIHRvIHRoZSBwbGFuXG4gICAgICAjIFxuICAgICAgaWYgbWFya2VyVG9wIDw9IDBcbiAgICAgICAgbWFya2VyWSA9IDBcbiAgICAgIGVsc2UgaWYgbWFya2VyQm90dG9tIDwgcGxhbkJvdHRvbVxuICAgICAgICBtYXJrZXJZID0gbWFya2VyVG9wXG4gICAgICBlbHNlXG4gICAgICAgIG1hcmtlclkgPSBwbGFuQm90dG9tIC0gbWFya2VySGVpZ2h0XG5cbiAgICAgICMgc2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgbWFya2VyXG4gICAgICAjIFxuICAgICAgbWFya2VyLmNzc1xuICAgICAgICBsZWZ0OiBtYXJrZXJYXG4gICAgICAgIHRvcDogbWFya2VyWVxuXG4gIGJpbmREcmFnZ2FibGU6IC0+XG4gICAgJChkb2N1bWVudCkub24oJ21vdXNlbW92ZScsIEBtb3VzZW1vdmUpXG4gICAgJChkb2N1bWVudCkub24oJ21vdXNldXAnLCBAbW91c2V1cClcblxuICBtYXJrZXJzOiAtPlxuICAgIEBtYXJrZXJzQ29udGFpbmVyLmZpbmQoJy5wbGFuaXQtbWFya2VyJylcblxuICBkcmFnZ2luZ01hcmtlcjogLT5cbiAgICBAbWFya2Vyc0NvbnRhaW5lci5maW5kKCcucGxhbml0LW1hcmtlci5pcy1kcmFnZ2luZycpXG5cbiAgbGFzdE1hcmtlcjogLT5cbiAgICBAbWFya2VycygpLmxhc3QoKVxuXG4gIHJhbmRvbVN0cmluZzogKGxlbmd0aCA9IDE2KSAtPlxuICAgIHN0ciA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpIFxuICAgIHN0ciA9IHN0ciArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpXG4gICAgc3RyLnN1YnN0cmluZygwLCBsZW5ndGggLSAxKVxuIl19